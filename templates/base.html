<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ title }}</title>
    <link rel="stylesheet" href="/static/base.css">
    <link rel="stylesheet" href="/static/help.css">
    <link rel="stylesheet" href="/static/labels.css">
    {% block head_extra %}{% endblock %}
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
</head>


<body>
    <header class="header">
        <a href="/" class="header-link">
            <div class="title">{{ app_title }} <span class="app-version">v{{ app_version }}</span></div>
            <div class="sub">
                {% if title and title != app_title %}{{ title }}{% else %}Personal self-hosted database{% endif %}
            </div>
        </a>
        <nav class="nav">
            <a href="/" class="navlink">Inventory</a>
            <a href="/containers/labels" class="navlink">Labels</a>
            <a href="/restore" class="navlink">Restore</a>
            <a href="/help" class="navlink">Usage</a>
        </nav>
    </header>

    <main class="main">
        {% block content %}{% endblock %}
    </main>

    <footer class="footer">
        {% block footer %}
        <span>Tip: search by Container ID (e.g., BX-03).</span>
        {% endblock %}
    </footer>

    <script>
        (function () {
            // Touch devices don't have hover; enable tap-to-toggle for hover popups.
            var isTouch = window.matchMedia && (
                window.matchMedia('(hover: none)').matches ||
                window.matchMedia('(pointer: coarse)').matches
            );

            if (!isTouch) return;

            function closeAll(except) {
                document.querySelectorAll('.hover-preview.is-open').forEach(function (el) {
                    if (except && el === except) return;
                    el.classList.remove('is-open');
                    // If focus remains inside, :focus-within can keep the bubble visible.
                    if (el.contains(document.activeElement) && document.activeElement && document.activeElement.blur) {
                        document.activeElement.blur();
                    }
                });
            }

            document.addEventListener('click', function (e) {
                var trigger = e.target.closest('.hover-preview > button');
                if (!trigger) {
                    // Tap outside closes any open bubble.
                    closeAll();
                    return;
                }

                var wrapper = trigger.parentElement;
                var hasHxGet = trigger.hasAttribute('hx-get');

                // First tap: open bubble (prevent edit/navigation).
                if (!wrapper.classList.contains('is-open')) {
                    e.preventDefault();
                    e.stopPropagation();
                    closeAll(wrapper);
                    wrapper.classList.add('is-open');
                    try { trigger.focus(); } catch (_) {}
                    return;
                }

                // Second tap:
                // - if this is an "edit" button (hx-get), allow default to proceed.
                // - otherwise, just close.
                if (!hasHxGet) {
                    e.preventDefault();
                    e.stopPropagation();
                    wrapper.classList.remove('is-open');
                }
            }, true);

            // Prevent taps inside the bubble from closing it immediately.
            document.addEventListener('click', function (e) {
                var bubble = e.target.closest('.hover-preview__bubble');
                if (!bubble) return;

                // Close button inside bubble.
                if (e.target.closest('.hover-preview__close')) {
                    e.preventDefault();
                    e.stopPropagation();
                    var wrapper = bubble.closest('.hover-preview');
                    if (wrapper) wrapper.classList.remove('is-open');
                    if (document.activeElement && document.activeElement.blur) {
                        document.activeElement.blur();
                    }
                    return;
                }

                e.stopPropagation();
            }, true);
        })();
    </script>

</body>


</html>